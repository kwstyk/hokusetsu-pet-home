---
// src/pages/cases/[slug].astro
import BaseLayout from '../../layouts/BaseLayout.astro';
import { SITE } from '../../config/site';
import { getAllCases, getCaseBySlug, type CaseEntry } from '../../data/cases';

// ★ これが必須：どの slug のページをビルドするかを Astro に教える
export async function getStaticPaths() {
  const entries = getAllCases();

  return entries.map((entry) => ({
    params: { slug: entry.slug },
  }));
}

const { slug } = Astro.params;
const entry = getCaseBySlug(slug as string) as CaseEntry | undefined;

if (!entry) {
  throw new Error(`Case not found for slug: ${slug}`);
}

const pageTitle = `${entry.title}｜成約事例｜${SITE.name}`;
---

<BaseLayout title={pageTitle}>
  <main class="mx-auto max-w-5xl px-4 py-10 sm:px-6 lg:px-8 space-y-8 text-sm text-slate-700">
    <nav class="text-[11px] text-slate-500">
      <a href="/" class="hover:underline">トップ</a>
      <span> ／ </span>
      <a href="/cases/" class="hover:underline">成約事例</a>
      <span> ／ </span>
      <span>{entry.title}</span>
    </nav>

    <header class="space-y-2">
      <p class="text-[11px] font-semibold text-emerald-700 tracking-wide">
        {entry.dealType === 'rent' ? '賃貸' : '購入'} ／ {entry.areaLabel} ／ {entry.pets}
      </p>
      <h1 class="text-2xl md:text-3xl font-bold text-slate-900">
        {entry.title}
      </h1>
      <p class="text-[11px] text-slate-500">
        公開日：{entry.publishedAt} ／ エリア：{entry.city} ／ 家族構成：{entry.household}
      </p>
      <p class="mt-2 text-sm md:text-base text-slate-700 leading-relaxed">
        {entry.lead}
      </p>
    </header>

    <section class="space-y-2">
      <h2 class="text-sm font-semibold text-slate-900">
        ご相談の背景・お悩み
      </h2>
      <p class="whitespace-pre-line text-sm leading-relaxed text-slate-700">
        {entry.beforeIssues}
      </p>
    </section>

    <section class="space-y-2">
      <h2 class="text-sm font-semibold text-slate-900">
        ご提案の方向性と最終的に決まったお部屋
      </h2>
      <p class="whitespace-pre-line text-sm leading-relaxed text-slate-700">
        {entry.afterOutcome}
      </p>
    </section>

    {entry.memo && (
      <section class="space-y-2">
        <h2 class="text-sm font-semibold text-slate-900">
          補足メモ
        </h2>
        <p class="whitespace-pre-line text-sm leading-relaxed text-slate-700">
          {entry.memo}
        </p>
      </section>
    )}

    <section class="mt-6 rounded-xl border border-slate-200 bg-slate-50 p-4 text-[13px] text-slate-700 space-y-2">
      <p class="font-semibold text-slate-900">
        似た状況でご相談されたい方へ
      </p>
      <p>
        この事例に近いお悩みがある場合は、まずは
        <a href="/first-time/" class="text-emerald-700 hover:underline">
          初めての方へ
        </a>
        をご確認いただいた上で、
        <a href="/contact/" class="text-emerald-700 hover:underline">
          LINE からご相談
        </a>
        いただければ、現在の状況をお伺いしながら一緒に条件整理を進めていきます。
      </p>
    </section>
  </main>
</BaseLayout>
