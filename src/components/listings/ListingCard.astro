---
// src/components/listings/ListingCard.astro

import type { Listing } from '../../data/listings';

interface Props {
  listing: Listing;
}

const { listing } = Astro.props;

const isRent = listing.dealType === 'rent';
const isAvailable = listing.status === 'available';

const detailUrl = `/listings/${listing.slug}/`;
const contactUrl = `/contact/?ref=${encodeURIComponent(listing.id)}`;
---

<article class="flex flex-col h-full rounded-xl border border-slate-200 bg-white shadow-sm">
  <div class="aspect-4/3 w-full overflow-hidden rounded-t-xl bg-slate-100">
    {listing.images?.[0] ? (
      <img
        src={listing.images[0]}
        alt={listing.title}
        loading="lazy"
        class="h-full w-full object-cover"
      />
    ) : (
      <div class="flex h-full items-center justify-center text-xs text-slate-400">
        写真準備中
      </div>
    )}
  </div>

  <div class="flex flex-1 flex-col gap-3 p-4">
    <header class="flex items-start justify-between gap-2">
      <div class="flex flex-col gap-1">
        <p class="text-xs text-slate-500">
          {listing.areaLabel}
        </p>
        <h3 class="text-base font-semibold leading-snug text-slate-900">
          {listing.title}
        </h3>
      </div>
      <div class="flex flex-col items-end gap-1">
        <span
          class={`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold ${
            isRent
              ? 'bg-sky-50 text-sky-700'
              : 'bg-emerald-50 text-emerald-700'
          }`}
        >
          {isRent ? '賃貸' : '購入'}
        </span>
        <span
          class={`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] ${
            isAvailable
              ? 'bg-emerald-50 text-emerald-700'
              : 'bg-slate-100 text-slate-500'
          }`}
        >
          {listing.status === 'available'
            ? '募集中'
            : listing.status === 'reserved'
            ? '申込あり・審査中'
            : '成約済み'}
        </span>
      </div>
    </header>

    <p class="text-sm leading-relaxed text-slate-700">
      {listing.summary}
    </p>

    <div class="space-y-1 text-sm">
      {isRent ? (
        <p class="font-semibold text-slate-900">
          賃料：{listing.rent?.toLocaleString()}円
          {listing.managementFee
            ? `（管理費 ${listing.managementFee.toLocaleString()}円）`
            : null}
        </p>
      ) : (
        <p class="font-semibold text-slate-900">
          価格：{listing.price?.toLocaleString()}万円
        </p>
      )}
      <p class="text-xs text-slate-600">
        {listing.floorPlan}｜{listing.exclusiveAreaSqm}㎡｜
        {listing.builtYear}年築
      </p>
      <p class="text-xs text-slate-600">
        {listing.city}｜{listing.nearestStation} 徒歩
        {listing.stationWalkMinutes}分
      </p>
    </div>

    <div class="flex flex-wrap gap-1.5 text-[11px]">
      {listing.petTags.map((tag) => (
        <span class="rounded-full bg-emerald-50 px-2 py-0.5 text-emerald-700">
          {tag}
        </span>
      ))}
    </div>

    <div class="mt-3 flex gap-2">
      <a
        href={detailUrl}
        class="inline-flex flex-1 items-center justify-center rounded-full border border-slate-300 px-3 py-2 text-sm font-medium text-slate-800 hover:bg-slate-50"
      >
        詳しく見る
      </a>
      <a
        href={contactUrl}
        class="inline-flex flex-1 items-center justify-center rounded-full bg-emerald-600 px-3 py-2 text-sm font-semibold text-white hover:bg-emerald-700"
      >
        LINEで相談
      </a>
    </div>
  </div>
</article>
